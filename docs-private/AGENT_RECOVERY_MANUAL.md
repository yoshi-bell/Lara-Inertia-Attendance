# 🟢 メタ定義: このファイルの責務 (AIエージェント用)
> **AIエージェントへの指示 (Prompt Repetition Strategy):**
> このファイルの指示を確実に遂行するため、このファイルの内容を**「合計2回」**読み込んでください。
> 1回目は全体像の把握、2回目はルールの定着として処理し、その後、次のステップへ進んでください。

*   **役割:** エージェントの「初期化」と「コンテキスト復旧」。プロジェクトの全ドキュメントへの入り口。
*   **読むべきタイミング:** 新しいチャットセッションを開始した直後に「1回のみ」読み込むこと。
*   **思考の優先順位:** 最優先。まずこのファイルに従って自身の「モード」をセットアップせよ。

---

# AIエージェント復旧マニュアル

## 0. エージェントの役割 (Persona)
あなたは「Lara-Inertia-Attendance」プロジェクトの リードフルスタックエンジニア です。
本プロジェクトは、旧勤怠アプリ（Laravel 8 / Blade）を、最新の技術スタック（Laravel 12 / Inertia / React / TypeScript）へリファクタリングする任務を負っています。あなたのメモリ（コンテキスト）がリセットされた場合は、以下の手順を実行して復旧してください。

## 1. 復旧チェックリスト (Recovery Checklist)

### ステップ 1: 基盤知識と現状の完全同期 (Foundation & Context Sync)
*   [ ] **コア・ドキュメントの完全理解:**
    *   `RULES_AND_ARCHITECTURE.md`, `IMPLEMENTATION_STANDARDS.md`, `WORKFLOW.md`, `DEV_LOG.md` をそれぞれ合計2回ずつ読み込む。
    *   これにより、プロジェクトの「憲法（アーキテクチャ）」「法律（規約）」「手順（ワークフロー）」「歴史（作業ログ）」を脳内に完全にインデックスする。
*   [ ] **プロジェクトの現在地の特定:**
    *   `WORKFLOW.md` のロードマップと `DEV_LOG.md` の記述を照らし合わせ、現在の正確なフェーズと直前の技術的決定事項を把握する。

### ステップ 2: 思考とスタイルの同期 (Alignment of Intent & Style)
*   [ ] **既存実装の教師データ化:**
    *   `Step 1` で確認した「完了済み」機能に関連するソースコード（Pages, Components, Services, Hooks）をリストアップし、それらを読み込む。
    *   単にコードを理解するだけでなく、命名規則、コンポーネントの分割粒度、Propsの設計パターン、TypeScriptの型定義スタイルなど、**「前任のエージェントが残した具体的なコードの履歴」**を分析する。
*   [ ] **方向性の継承とアラインメント:**
    *   分析結果からプロジェクト自体のコードの慣習や設計の方向性を学習し、自身の思考や出力を復旧前のエージェントの意図に最大限寄り添わせる。

### ステップ 3: タスク分析と実装戦略 (Legacy Analysis & Strategy)
*   [ ] **レガシー資産（旧プロジェクト）の分析:**
    *   リファクタリング対象の旧プロジェクト（`Onoe-Attendance/src`）から、これから着手する機能に関連するコントローラーやビューを読み込み、ロジックの「正解」とデザインの「意図」を抽出する。
*   [ ] **再利用と拡張の方針決定:**
    *   「新規作成」よりも「既存コンポーネントの拡張・共通化」を最優先する。
    *   分析結果に基づき、何をサービス層へ共通化し、何をコンポーネントとして分離するかという具体的な設計方針を立ててから実装に入る。

### ステップ 4: 結論の導出と報告
*   [ ] **現状の判定:** 以上のプロセスを経て、現在のタスクを遂行するための準備が整ったことをユーザーに報告する。

### ステップ 2: 実装状況の検証 (Code Verification)

#### 新プロジェクト環境 (Laravel 12 / Inertia):
*   [ ] **環境の確認:** Laravel 12 (PHP 8.4) + Sail + MySQL 環境が正常にセットアップされているか。
*   [ ] **認証基盤:** Laravel Breeze (Inertia/React版) が導入され、基本的なログイン・登録機能が動作するか。
*   [ ] **フロントエンド:** React 19 + TypeScript + Vite + Tailwind CSS の環境が整っているか。

#### 旧プロジェクト資産 (Legacy Assets):
*   [ ] **旧プロジェクトの参照:** 一つ上の階層にある `Onoe-Attendance/src` に、移植対象の旧ロジック（コントローラー、モデル、マイグレーション）が存在することを確認する。

### ステップ 3: 結論の導出と報告
*   [ ] **現状の判定:** 最新環境でのリファクタリング基盤が整い、旧プロジェクトからの機能移植を開始できる状態である。

## 2. 重要事項 (Core Rules)
*   **日本語対応:** 全ての思考と応答を日本語で行うこと。
*   **ドキュメントの同期:** 作業完了時は必ず `DEV_LOG.md` を更新し、その内容に基づいて `AGENT_RECOVERY_MANUAL.md` を最新化すること。
*   **Gitコミット:** 日本語メッセージとプレフィックス（`feat:`, `fix:`, `docs:`, `test:`, `chore:`, `refactor:` 等）を必ず使用すること。

## 3. 想定される結論 (Hypothesis: 2026-02-11最終更新)

現在のフェーズ: Phase 4: 管理者機能の実装 (Admin Features)

完了していること:
✅ 最新の Laravel 12 プロジェクトの初期生成。
✅ Inertia.js (React + TypeScript) および Laravel Breeze 認証基盤の導入。
✅ 旧プロジェクトからのマイグレーション・モデル・シーダーの完全移植。
✅ 共通レイアウト（AttendanceLayout）の新設による旧デザインの再現。
✅ ヘッダーおよびナビゲーションのコンポーネント化による再利用性の向上。
✅ 修正申請機能のバックエンド実装完了（バリデーション・トランザクション保存）。
✅ ルーティング全般を基本設計書 (CSV) の定義に完全同期。
✅ 管理者認証基盤（管理者フラグ認可、ミドルウェア、専用ログイン画面）の実装。
✅ 一般・管理者の両詳細画面における、useEffect を用いた非同期データ同期（モダンリファクタリング）の完遂。
✅ カスタムフック（useCorrectionForm）の導入による、ビジネスロジックと UI の分離・共通化。
✅ 管理者用日次勤怠一覧 (US010) および直接修正 (US011) の実装完了。
✅ 管理者用修正申請の承認フロー（一覧・承認・データ反映）の完遂。
✅ 全ページにおける any 排除と、SSOT に基づく型定義の一本化（TypeScript 偏差値向上）。
✅ 重大なバグ（タイムゾーン不整合、計算ロジック不備、深夜跨ぎ未対応）の完全修正。

未完了・次のタスク:
🚀 スタッフ管理（一覧・スタッフ別月次一覧）の実装。
🚀 メール認証機能 (FN011) の実装。
